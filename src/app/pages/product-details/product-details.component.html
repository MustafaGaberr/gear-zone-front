<div class="container my-4">
  <div class="back-to-products mb-4">
    <a routerLink="/products" class="text-decoration-none text-secondary"><img src="assets/images/Vector.svg"
        class="m-3" />Back to Products</a>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading product details...</p>
  </div>
  }

  <!-- Product Not Found -->
  @if (!isLoading && !product) {
  <div class="text-center py-5">
    <i class="bi bi-exclamation-circle display-1 text-muted"></i>
    <p class="mt-3 text-muted">Product not found</p>
    <a routerLink="/products" class="btn btn-primary">Back to Products</a>
  </div>
  }

  <!-- Main Product Card (Contains Everything) -->
  @if (!isLoading && product) {
  <div class="card-body p-lg-5">
    <!-- Product Info Row -->
    <div class="row">
      <!-- Product Images Column -->
      <div class="col-lg-6 mb-4">

        <img [src]="currentMainImage" [alt]="product.name" class="main-image img-fluid rounded-3 shadow-sm"
          style="width: 100%; height: 400px; object-fit: cover;">

        <div class="thumbnail-images mt-3 d-flex gap-2">

          @for (img of productImages; track img) {
          <img [src]="img" (click)="changeImage(img)" [class.active-thumb]="currentMainImage === img"
            class="img-thumbnail cursor-pointer" alt="Thumbnail"
            style="width: 100px; height: 80px; object-fit: cover; cursor: pointer;">
          }

        </div>
      </div>

      <!-- Product Info Column -->
      <div class="col-lg-6 ps-lg-5">
        <h1 class="fw-bold display-5">{{ product.name }}</h1>
        <div class="d-flex align-items-center mb-3 text-secondary">
          <span><i class="bi bi-star-fill text-warning me-1"></i> {{ product.ratingsAverage }} ({{
            product.ratingsQuantity }} reviews)</span>
          <span class="mx-2">|</span>
          @if (product.stock > 0) {
          <span class="text-success fw-bold"><i class="bi bi-check-circle-fill me-1"></i>{{ product.stock }} in
            stock</span>
          } @else {
          <span class="text-danger fw-bold"><i class="bi bi-x-circle-fill me-1"></i>Out of stock</span>
          }
        </div>
        <div class="product-price mb-3">
          @if (product.priceAfterDiscount) {
          <span class="current-price">${{ product.priceAfterDiscount }}</span>
          <span class="original-price text-muted">${{ product.price }}</span>
          <span class="save-percent">Save {{ getDiscountPercentage() }}%</span>
          } @else {
          <span class="current-price">${{ product.price }}</span>
          }
        </div>
        <p class="text-secondary mb-4">{{ product.description }}</p>

        <div class="d-flex align-items-center mb-4">
          <strong class="me-3">Quantity</strong>
          <div class="quantity-buttons btn-group" role="group">
            <button type="button" class="btn btn-outline-secondary rounded-pill-start" (click)="decrement()">-</button>
            <span class="btn btn-outline-secondary disabled">{{ count() }}</span>
            <button type="button" class="btn btn-outline-secondary rounded-pill-end" (click)="increment()">+</button>
          </div>
        </div>

        <div class="d-flex gap-2 mb-4">
          <button class="btn btn-primary btn-lg flex-grow-1" [disabled]="product.stock === 0" (click)="addToCart()"><i
              class="bi bi-cart-plus me-2"></i>Add to Cart</button>
          <button class="btn btn-outline-secondary rounded-3"><i class="bi bi-heart"></i></button>
          <button class="btn btn-outline-secondary rounded-3"><i class="bi bi-share"></i></button>
        </div>

        <div class="key-features mt-4 p-4 rounded-3">
          <h4 class="fw-semibold mb-3">Product Info</h4>
          <ul class="list-unstyled">
            @if (product.brand) {
            <li class="mb-2"><strong>Brand:</strong> {{ product.brand.name }}</li>
            }
            @if (product.category) {
            <li class="mb-2"><strong>Category:</strong> {{ product.category.name }}</li>
            }
            @if (product.sold) {
            <li class="mb-2"><strong>Sold:</strong> {{ product.sold }} items</li>
            }
          </ul>
        </div>

        <!-- Services Row (Modified for aspect ratio) -->
        <div class="row text-center mt-4">
          <div class="col-md-4 mb-3">
            <div class="service-card p-3 rounded-4">
              <img src="assets/images/Icon.svg" alt="Warranty Icon" class="service-icon mb-2">
              <p class="text-secondary mb-0 mt-2">2 Year Warranty</p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="service-card p-3 rounded-4">
              <img src="assets/images/Icon2.svg" alt="Warranty Icon" class="service-icon mb-2">
              <p class="text-secondary mb-0 mt-2">Free Shipping</p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="service-card p-3 rounded-4">
              <img src="assets/images/Icon3.svg" alt="Warranty Icon" class="service-icon mb-2">
              <p class="text-secondary mb-0 mt-2">Easy Returns</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Specifications and Seller Row -->
    <div class="row p-4 mt-5 border border-2 rounded-4">
      <div class="col-md-6 mb-4">
        <h2 class="fw-bold mb-3">Product Details</h2>
        <table class="table lh-lg">
          <tbody>
            <tr>
              <td class="text-secondary">Name</td>
              <td class="text-end">{{ product.name }}</td>
            </tr>
            @if (product.brand) {
            <tr>
              <td class="text-secondary">Brand</td>
              <td class="text-end">{{ product.brand.name }}</td>
            </tr>
            }
            @if (product.category) {
            <tr>
              <td class="text-secondary">Category</td>
              <td class="text-end">{{ product.category.name }}</td>
            </tr>
            }
            <tr>
              <td class="text-secondary">Price</td>
              <td class="text-end">${{ product.price }}</td>
            </tr>
            <tr>
              <td class="text-secondary">Stock</td>
              <td class="text-end">{{ product.stock }} units</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="col-md-6">
        <h2 class="fw-bold mb-3">Seller Information</h2>
        <div class="seller-card p-4 bg-#F9FAFB rounded-4">
          <h5 class="fw-bold">Gear Zone Store</h5>
          <p class="mb-1"><i class="bi bi-star-fill text-warning me-1"></i> 4.9 seller rating</p>
          <p class="mb-1"><i class="bi bi-box-seam me-1"></i> Trusted Seller</p>
          <p class="text-secondary"><i class="bi bi-geo-alt-fill me-1"></i> Egypt</p>
          <button class="btn btn-outline-primary w-100 mt-2 bg-white py-2 rounded-4 btn-contact">
            <i class="bi bi-chat-left mx-2"></i>Contact Seller
          </button>
        </div>
      </div>
    </div>
  </div>
  }
</div>