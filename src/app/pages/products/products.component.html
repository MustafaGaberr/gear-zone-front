<div class="products-container">
  <div class="main-content">

    <aside class="filters-sidebar">
      <div class="filter-header">
        <h3>{{ translationService.translate('products.filters') }}</h3>
      </div>

      <div class="filter-group">
        <label>{{ translationService.translate('common.search') }}</label>
        <div class="input-wrapper">
          <input type="text" [placeholder]="translationService.translate('products.search')" [(ngModel)]="searchTerm"
            (input)="applyFilters()" />
        </div>
      </div>

      <div class="filter-group">
        <label>{{ translationService.translate('products.allCategories') }}</label>
        <ul class="category-list">
          <li>
            <a href="javascript:void(0)" (click)="onCategoryChange('all')"
              [class.active]="selectedCategoryId === 'all'">
              {{ translationService.translate('products.allCategories') }}
            </a>
          </li>

          @for (cat of categories; track cat._id) {
          <li>
            <a href="javascript:void(0)" (click)="onCategoryChange(cat._id)"
              [class.active]="selectedCategoryId === cat._id">
              {{ cat.name }}
            </a>
          </li>
          }
        </ul>
      </div>

      <div class="filter-group">
        <label>{{ translationService.translate('products.priceRange') }}</label>
        <div class="price-range">
          <div class="price-inputs">
            <input type="number" [(ngModel)]="priceRange[0]" (change)="applyFilters()" placeholder="Min">
            <span>-</span>
            <input type="number" [(ngModel)]="priceRange[1]" (change)="applyFilters()" placeholder="Max">
          </div>
        </div>
      </div>

    </aside>

    <section class="products-section">

      <div class="section-header">
        <h2>{{ translationService.translate('products.title') }}</h2>
        <span class="text-muted">{{ filteredProducts.length }} {{ translationService.currentLang() === 'ar' ? 'منتج' :
          'products found' }}</span>
      </div>

      @if (products.length === 0 && filteredProducts.length === 0) {
      <div class="text-center py-5">{{ translationService.translate('common.loading') }}</div>
      }

      @if (filteredProducts.length > 0) {
      <div class="products-grid">

        @for (product of filteredProducts; track product._id) {
        <div class="product-card">

          <a [routerLink]="['/product-details', product._id]" class="product-image-link">
            <div class="product-image">
              <img [src]="product.imageCover" [alt]="product.name">

              @if (product.stock > 0) {
              <span class="stock-badge in-stock">{{ translationService.currentLang() === 'ar' ? 'متوفر' : 'In Stock'
                }}</span>
              } @else {
              <span class="stock-badge out-stock">{{ translationService.translate('products.outOfStock') }}</span>
              }
            </div>
          </a>

          <div class="product-info">

            <div class="info-top">
              <h3 [title]="product.name">{{ product.name }}</h3>

              <div class="rating">
                <span class="star-icon">★</span>
                <span>{{ product.ratingsAverage }}</span>
                <span class="review-count">({{ product.ratingsQuantity }})</span>
              </div>
            </div>

            <p class="company-name">{{ product.brand?.name || product.category.name }}</p>

            <div class="card-footer-custom">

              <div class="price-block">
                @if (product.priceAfterDiscount) {
                <span class="current-price">{{ product.priceAfterDiscount | currency:'USD' }}</span>
                <span class="old-price">{{ product.price | currency:'USD' }}</span>
                } @else {
                <span class="current-price">{{ product.price | currency:'USD' }}</span>
                }
              </div>

              <button class="add-btn" [disabled]="product.stock === 0" (click)="addToCart(product._id)">
                <i class="bi bi-cart-plus"></i> {{ translationService.translate('products.addToCart') }}
              </button>

            </div>
          </div>
        </div>
        }

      </div>
      } @else if (products.length > 0) {
      <div class="empty-state">
        <h3>{{ translationService.translate('products.noProducts') }}</h3>
        <button (click)="clearFilters()">{{ translationService.translate('products.clearFilters') }}</button>
      </div>
      }

    </section>
  </div>
</div>